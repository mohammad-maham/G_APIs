@model User
@{
    Layout = "_LayoutSign";
}

<div class="form-content">

    <h1 class="">صفحه   ثبت نام <a href="#"><span class="brand-name">کاربر جدید</span></a></h1>
    <p class="signup-link">        اکانت دارید؟ <a asp-action="Login" asp-controller="Account">     وارد شوید!</a></p>

    <form class="registerForm" id="registerForm" action="javascript:void(0);" novalidate>

        <div class="form">

            <div id="username-field" class="field-wrapper input">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                <input name="NationalCode" type="text" class="form-control basic" maxlength="10" placeholder="  کد ملی" required>

                <div class="invalid-feedback">
                    وارد کردن این گزینه الزامیست
                </div>
            </div>
            <div id="password-field" class="field-wrapper input mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                <input name="Mobile" type="text" class="form-control " maxlength="10" placeholder="  موبایل   را بدون صفر اولیه وارد کنید" required>

                <div class="invalid-feedback">
                    وارد کردن این گزینه الزامیست
                </div>
            </div>


            <div class="registerResult alert alert-danger hide" role="alert">
                <p></p>
            </div>

        </div>
        <div class="field-wrapper">
            <button class="btn btn-primary submit-fn mt-2  float-right" type="submit">  ثبت نام</button>
        </div>

    </form>

    <form class="confirmForm hide" id="confirmForm" action="javascript:void(0);" novalidate>

        <input id="nationalCode" name="NationalCode" type="hidden" value="">
        <input id="mobile" name="Mobile" type="hidden" value="">


        <div class="form">
            <div id="confirm-field" class="field-wrapper input mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                <input name="ConfirmCode" type="text" class="form-control" placeholder="کد تایید را وارد کنید  " required>
                <div class="invalid-feedback">
                    وارد کردن این گزینه الزامیست
                </div>
            </div>
            <div class="registerResult alert alert-danger hide" role="alert">
                <p></p>
            </div>
        </div>
        <div class="field-wrapper">
            <button class="btn btn-primary submit-fn mt-2  float-right" type="submit">  ثبت نام  </button>
        </div>
    </form>

    <form class="setPasswordForm hide" id="setPasswordForm" action="javascript:void(0);" novalidate>

        <input id="nationalCode_2" name="NationalCode" type="hidden" value="">

        <div class="form">
            <div id="confirm-field" class="field-wrapper input mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
                <input name="ConfirmCode" type="text" class="form-control" placeholder="کد تایید را وارد کنید  " required>
                <div class="invalid-feedback">
                    وارد کردن این گزینه الزامیست
                </div>
            </div>
            <div class="registerResult alert alert-danger hide" role="alert">
                <p></p>
            </div>
        </div>
        <div class="field-wrapper">
            <button class="btn btn-primary submit-fn mt-2  float-right" type="submit">  ثبت    </button>
        </div>
    </form>
    @* <p class="terms-conditions">©  تمامی حقوق محفوظ است.</p> *@

</div>

<script>

    $('input.basic').maxlength({
        placement: "left"
    });

    $('#registerForm').ajaxForm({

        validation: true,
        url: '/Account/GetConfirmCode',
        JWT: false,
        success: function (response) {
            console.log(response)

            if (response.result) {

                var obj = JSON.parse(response.data);
                $('#mobile').val(obj.Mobile);
                $('#nationalCode').val(obj.NationalCode);

                $('#registerForm').hide();
                $('#confirmForm').show();

            } else {
                $('.registerResult').html(response.message).show();
            }
        },
        error: function (xhr, status, error) {
            $('.registerResult').html(response.message).show();
            // $('.registerResult').html('خطایی رخ داده لطفا دوباره تلاش نمایید.').show();
            console.error('Form submission failed:', error);
        }
    });

    $('#confirmForm').ajaxForm({

        validation: true,
        url: '/Account/Register',
        JWT: false,
        success: function (response) {

            if (response.result) {

                var obj = JSON.parse(response.data);
                $('#nationalCode_2').val(obj.NationalCode);

                $('#confirmForm').hide();
                $('#setPasswordForm').show();

            } else {
                $('.registerResult').html(response.message).show();
            }

        },
        error: function (xhr, status, error) {
            // $('.registerResult').html('خطایی رخ داده لطفا دوباره تلاش نمایید.').show();
            $('.registerResult').html(response.message).show();
            console.error('Form submission failed:', error);
        }
    });

    $('#SetPasswordForm').ajaxForm({

        validation: true,
        url: '/Account/SetPassword',
        JWT: false,

        success: function (response) {
        
            if (response.result == 3) {

                var obj = JSON.parse(response.data);
                localStorage.setItem('Authorization', obj.JWT);

                $('.registerResult').html(response.message).show();

                setTimeout(3000, () => {
                    window.location.href = '/Home';
                })
            }
            else if (response.result == true) {
                $('.registerResult').html(response.message).show();
            } else {
                $('.registerResult').html(response.message).show();
            }
        },
        error: function (xhr, status, error) {
            // $('.registerResult').html('خطایی رخ داده لطفا دوباره تلاش نمایید.').show();
            $('.registerResult').html(response.message).show();
            console.error('Form submission failed:', error);
        }
    });

</script>

